---
title: "Counties"
description: "Counties"
output: 
  rmarkdown::html_vignette:
    toc: true
vignette: >
  %\VignetteIndexEntry{Counties}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
editor_options: 
  markdown: 
    wrap: 80
---

```{r developernote, eval=FALSE, echo=FALSE, include=FALSE}
#  *>>>>>>>>>> Developer note: vignettes need to be tested/edited/rebuilt regularly <<<<<<<<<<<*
#    - **See ?pkgdown::build_site** and script in EJAM/data-raw/- EJAM uses the pkgdown R package to build help and articles/ vignettes as web pages
```

```{r SETUP_default_eval_or_not, include=FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  fig.height = 6, fig.width = 7,
  comment = "#>"
)
knitr::opts_chunk$set(eval = FALSE)
# https://r-pkgs.org/vignettes.html
```

```{r libraryEJAM, eval=TRUE, echo=FALSE, include=FALSE}
# rm(list = ls()); golem::detach_all_attached(); devtools::load_all()
 
if (!exists("blockgroupstats")) {library(EJAM)} # use installed version only if pkg not yet attached
library(data.table)
# dataload_dynamic('all') # varnames = all  currently means all defined by .arrow_ds_names

# indexblocks()
```

Note: This article is a work in progress

# Perspectives on US Counties and how skewed county distributions are

A few large counties contain a large proportion of the US population. This
vignette explores the distribution of counties in the US, and how many counties
have a large number of block groups.

A handful of counties have over 1000 block groups, while most counties have less
than 25 block groups each. These are the largest counties in terms of how many
blockgroups they contain:

```{r stats, eval=TRUE, echo=TRUE}
z <- blockgroupstats[ , .(pop = sum(pop), bgcount = .N), by = .(countyfips = substr(bgfips,1,5))][order(bgcount), ]
z[ , name := fips2name(countyfips)]
x = data.frame(z[bgcount >= 1000, ])
print(x)
# print( z[bgcount >= 1000, ][] )
```

These are the largest counties in terms of how many blockgroups they contain:

```{r, bigpop}
tail(z[order(pop), ], 10)
```

Map of counties with more than 1,000 blockgroups each

```{r}
shp <- cbind(shapes_from_fips(fips = z[bgcount >= 1000, ]$countyfips), blockgroup_count = z[bgcount >= 1000, ]$bgcount)
suppressMessages(suppressWarnings({
mapfast(shp)

  ## to see the map of key counties in a web browser:
# mp <- mapfast(shp, launch_browser = TRUE)
}))
```

Scatterplot of population and \# of blockgroups, by county

```{r}

plot(z$bgcount, z$pop, xlab = "# of blockgroups in the county", ylab = "County population", log =  'xy')

```

Histogram showing that most counties have fewer than 25 blockgroups, but a few
have over 1000 each

```{r}
hist(x$blockgroup_count, breaks = c((0:60)*10,10000), xlim=c(0, 600), 
     main = "Most US Counties have fewer than 25 blockgroups \nbut 31 Counties (<1% of all) have 1k-7k each, and account for 22% of all blockgroups", 
     xlab = "count of blockgroups", ylab = "Relative Share of Counties", yaxt="n")
```
